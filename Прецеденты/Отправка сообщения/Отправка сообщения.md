# **Прецедент использования: Отправка сообщения**

### **Приложение:** EchoRatniy

---

#### **Рамки**
Приложение мгновенного обмена сообщениями **EchoRatniy**.

#### **Уровень**
Задача, определенная пользователем.

#### **Основной исполнитель**
**Пользователь.**

---

#### **Заинтересованные лица и их требования**
*   **Пользователь.** Хочет быстро и надежно отправлять сообщения, получать уведомления о доставке и видеть ошибки при сбое.
*   **Получатель.** Хочет получить сообщение своевременно и в полном объеме.
*   **Администратор.** Хочет контролировать работу системы, следить за безопасностью и поддерживать непрерывную работу сервиса.
*   **Служба уведомлений.** Должна получать корректные запросы на push-уведомления.
*   **Сервис хранения медиафайлов.** Должен корректно сохранять и отдавать вложения.
*   **Служба безопасности.** Должна проверять сообщения и блокировать опасный контент.

---

#### **Предусловия**
1.  Пользователь аутентифицирован и подключен к сети.
2.  Чат, в который отправляется сообщение, создан или выбран.

#### **Постусловия**
1.  Сообщение создано и сохранено в чате.
2.  Вложенные файлы загружены и привязаны к сообщению.
3.  Служба уведомлений отправила push-уведомления всем участникам чата.
4.  Статус сообщения обновлен как «доставлено» или «отправлено».

---

### **Основной успешный сценарий**
1.  Пользователь открывает чат для отправки сообщения.
2.  Пользователь вводит текст сообщения.
3.  При необходимости прикрепляет файлы к сообщению.
4.  Система проверяет сообщение на безопасность через **SecurityService**.
5.  Система создаёт объект **Message** и сохраняет его в списке сообщений чата.
6.  Система отправляет push-уведомления через **NotificationService**.
7.  Система обновляет статус сообщения как «**доставлено**».
8.  Пользователь получает подтверждение успешной отправки.

---

### **Расширения (альтернативные потоки)**
**а. Сбой сервиса уведомлений.**
    1. Система пытается повторно отправить уведомление.
    2. Если повторная отправка не удалась — система уведомляет пользователя о проблеме.

**б. Ошибка проверки безопасности.**
    1. Система блокирует сообщение и уведомляет пользователя.
    2. Пользователь может отредактировать сообщение и повторить отправку.

**в. Ошибка загрузки вложений.**
    1. Система уведомляет пользователя о проблеме с файлом.
    2. Пользователь может повторно загрузить файл или отправить сообщение без него.

**г. Прерывание отправки пользователем.**
    1. Пользователь отменяет ввод сообщения до отправки.
    2. Система удаляет черновик сообщения и возвращает интерфейс в исходное состояние.

---

### **Специальные требования**
*   Интерфейс должен быть доступен на мобильных и десктопных устройствах.
*   Поддержка локализации для нескольких языков.
*   **Время отклика системы не превышает 3 секунд** при нормальной загрузке.
*   Обеспечение надёжного хранения и восстановления сообщений при сбоях сети или сервера.
*   Возможность добавления новых бизнес-правил (например, фильтров контента или форматов вложений).

---

### **Список технологий и типов данных**
*   Отправка сообщений через **REST** или **WebSocket**.
*   Хранение вложений через облачное хранилище или **CDN**.
*   Проверка безопасности с помощью фильтров и антивирусных сервисов.
*   Состояние сообщений хранится в базе данных с поддержкой **ACID**.

---

### **Частота использования**
Почти постоянно — пользователи активно отправляют сообщения в режиме реального времени.

---

### **Открытые вопросы**
1.  Какие правила фильтрации контента использовать?
2.  Как обеспечить восстановление сообщений при сбое **NotificationService**?
3.  Нужно ли кэшировать медиафайлы локально?
4.  Как масштабировать сервис при росте количества пользователей?
